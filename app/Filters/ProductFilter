<?php 

use Illuminate\Http\Request;

Route::get('/products/filter', [ProductController::class, 'filter']);

public function Filter(Request $request)
{
    $query = $request->input('search');
    $category_id = $request->input('category');
    $brand_id = $request->input('brand');

    $products = Product::query();

    if ($query) {
        $products->where('name', 'like', "%$query%")
                 ->orWhere('description', 'like', "%$query%");
    }

    if ($category_id) {
        $products->where('category_id', $category_id);
    }

    if ($brand_id) {
        $products->where('brand_id', $brand_id);
    }

    return response()->json([
        'products' => $products->get()
    ]);
}


    public function byStock($inStock)
    {
        if ($inStock !== null) {
            if ($inStock) {
                $this->query->where('stock', '>', 0);
            } else {
                $this->query->where('stock', '<=', 0);
            }
        }

        return $this;
    }

    public function apply()
    {
        return $this->query;
    }

